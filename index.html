<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Repository File Viewer</title>
</head>
<body>
    <h1>GitHub Repository File Viewer</h1>
    <form id="github-form">
        <label for="token">GitHub Token:</label>
        <input type="password" id="token" name="token" required>
        <br>
        <label for="owner">Repository Owner:</label>
        <input type="text" id="owner" name="owner" required>
        <br>
        <label for="repo">Repository Name:</label>
        <input type="text" id="repo" name="repo" required>
        <br>
        <label for="package-manager">Package Manager:</label>
        <select id="package-manager" name="package-manager" required>
            <option value="npm">npm</option>
            <option value="pip">pip</option>
            <option value="maven">maven</option>
            <!-- Add other package managers as needed -->
        </select>
        <br>
        <button type="submit">Fetch Repository</button>
    </form>
    <form id="file-form" style="display:none;">
        <label for="files">Select File/Folder:</label>
        <select id="files" name="files"></select>
        <button type="submit">Fetch File</button>
    </form>
    <pre id="file-content"></pre>

    <script>
        function setCookie(name, value, days) {
            const date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            const expires = "expires=" + date.toUTCString();
            document.cookie = name + "=" + value + ";" + expires + ";path=/";
        }

        function getCookie(name) {
            const nameEQ = name + "=";
            const ca = document.cookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }

        function getDependencyFiles(packageManager) {
            const dependencyFiles = {
                npm: ['package.json'],
                pip: ['requirements.txt', 'setup.py'],
                maven: ['pom.xml']
                // Add other package managers and their dependency files as needed
            };
            return dependencyFiles[packageManager] || [];
        }

        async function fetchContents(path = '') {
            const token = document.getElementById('token').value;
            const owner = document.getElementById('owner').value;
            const repo = document.getElementById('repo').value;
            const packageManager = document.getElementById('package-manager').value;
            const dependencyFiles = getDependencyFiles(packageManager);

            const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`, {
                headers: {
                    'Authorization': `token ${token}`
                }
            });

            if (response.ok) {
                const data = await response.json();
                const filesSelect = document.getElementById('files');
                filesSelect.innerHTML = '';
                if (path) {
                    const option = document.createElement('option');
                    option.value = '..';
                    option.textContent = 'Go up one level';
                    filesSelect.appendChild(option);
                }
                data.forEach(item => {
                    if (item.type === 'dir' || dependencyFiles.includes(item.name)) {
                        const option = document.createElement('option');
                        option.value = item.path;
                        option.textContent = item.name;
                        filesSelect.appendChild(option);
                    }
                });
                document.getElementById('file-form').style.display = 'block';
                setCookie('selectedPath', path, 1);
            } else {
                document.getElementById('file-content').textContent = 'Error fetching repository';
            }
        }

        document.getElementById('github-form').addEventListener('submit', function(event) {
            event.preventDefault();
            fetchContents();
        });

        document.getElementById('file-form').addEventListener('submit', async function(event) {
            event.preventDefault();
            const path = document.getElementById('files').value;
            if (path === '..') {
                const currentPath = getCookie('selectedPath');
                const parentPath = currentPath.substring(0, currentPath.lastIndexOf('/')) || '';
                fetchContents(parentPath);
            } else {
                const token = document.getElementById('token').value;
                const owner = document.getElementById('owner').value;
                const repo = document.getElementById('repo').value;

                const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`, {
                    headers: {
                        'Authorization': `token ${token}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    if (Array.isArray(data)) {
                        fetchContents(path);
                    } else {
                        const content = atob(data.content);
                        document.getElementById('file-content').textContent = content;
                    }
                } else {
                    document.getElementById('file-content').textContent = 'Error fetching file';
                }
            }
        });

        window.onload = function() {
            const selectedPath = getCookie('selectedPath');
            if (selectedPath) {
                fetchContents(selectedPath);
            }
        };
    </script>
</body>
</html>
